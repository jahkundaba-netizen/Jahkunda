<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Poultry Farm — File Library</title>
  <meta name="description" content="Auto-updating file library from latest GitHub release. Files organized into categories. WhatsApp contact." />
  <style>
    :root{
      --brand:#2c7a0f;
      --accent:#ffb703;
      --bg:#f7faf9;
      --card:#ffffff;
      --muted:#6b7280;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,Segoe UI,Roboto,Arial;color:#07203a;background:var(--bg)}
    header{background:linear-gradient(90deg,var(--brand),#165814);color:#fff;padding:28px 18px;text-align:center}
    header h1{margin:0;font-size:1.6rem}
    header p{margin:6px 0 0;opacity:0.95}
    main{max-width:1100px;margin:28px auto;padding:0 18px 60px}
    .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 8px 24px rgba(2,6,23,0.06);margin-bottom:16px}
    h2{color:var(--brand);margin:0 0 8px}
    p.lead{color:var(--muted);margin:0 0 12px}
    .controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-bottom:12px}
    .search{flex:1;min-width:220px}
    input[type="search"]{width:100%;padding:10px 12px;border-radius:8px;border:1px solid #e6eef0}
    select{padding:10px;border-radius:8px;border:1px solid #e6eef0}
    .stats{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .stat{flex:1;min-width:140px;background:linear-gradient(180deg,#fff,#fbfff8);padding:10px;border-radius:10px}
    .stat .num{font-weight:700;color:var(--brand);font-size:1.1rem}
    /* file list */
    .category{margin-top:14px}
    .category h3{margin:0 0 6px;font-size:1rem;color:#0f172a}
    .file-list{list-style:none;padding:0;margin:0;display:grid;gap:8px}
    .file-item{display:flex;align-items:center;justify-content:space-between;padding:10px;border-radius:8px;background:#fbfdf9;border:1px solid #eef6ec}
    .file-meta{display:flex;gap:12px;align-items:center}
    .file-name{font-weight:600;color:#0f172a}
    .file-extra{font-size:0.85rem;color:var(--muted)}
    .download-btn{background:var(--brand);color:#fff;padding:8px 12px;border-radius:8px;text-decoration:none;font-weight:700}
    .download-btn:hover{opacity:0.95}
    /* empty */
    .empty{padding:18px;text-align:center;color:var(--muted)}
    /* whatsapp */
    .whatsapp-float{position:fixed;right:20px;bottom:20px;width:64px;height:64px;border-radius:50%;background:#25D366;display:flex;align-items:center;justify-content:center;color:#fff;box-shadow:0 10px 30px rgba(37,211,102,0.18);z-index:1300;text-decoration:none}
    .whatsapp-float svg{width:28px;height:28px}
    /* small screens */
    @media (max-width:640px){
      header h1{font-size:1.25rem}
      .controls{flex-direction:column;align-items:stretch}
    }
    /* subtle animation */
    .pulse{animation:pulse 2.8s infinite}
    @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.03)}100%{transform:scale(1)}}
  </style>
</head>
<body>
  <header>
    <h1>(Your Poultry Farm) — File Library</h1>
    <p>Latest files from the repository release (auto-updating). Upload by creating a GitHub Release — visitors can download directly here.</p>
  </header>

  <main>
    <section class="card" aria-labelledby="library-title">
      <h2 id="library-title">File Library (From latest GitHub Release)</h2>
      <p class="lead">This page fetches the latest release of a public GitHub repo and lists all attached assets. Files are grouped automatically by category for easy browsing.</p>

      <!-- Controls: configure owner & repo here -->
      <div class="controls">
        <!-- Owner & Repo inputs (for convenience) -->
        <div style="display:flex;gap:8px;">
          <input id="owner" placeholder="GitHub owner (username/org)" style="padding:10px;border-radius:8px;border:1px solid #e6eef0" value="" />
          <input id="repo" placeholder="Repository name" style="padding:10px;border-radius:8px;border:1px solid #e6eef0" value="" />
          <button id="loadBtn" style="padding:10px 14px;border-radius:8px;background:var(--brand);color:#fff;border:0;font-weight:700">Load Latest Release</button>
        </div>

        <div class="search">
          <input type="search" id="search" placeholder="Search files (name or ext) — e.g., sample.pdf or eggs" />
        </div>

        <div>
          <select id="filterType">
            <option value="all">All categories</option>
            <option value="images">Images</option>
            <option value="videos">Videos</option>
            <option value="documents">Documents</option>
            <option value="archives">Archives</option>
            <option value="others">Others</option>
          </select>
        </div>
      </div>

      <div class="stats" id="metaStats" style="display:none">
        <div class="stat"><div class="num" id="releaseTag">-</div><div class="file-extra">Release tag</div></div>
        <div class="stat"><div class="num" id="assetCount">0</div><div class="file-extra">Assets</div></div>
        <div class="stat"><div class="num" id="releaseDate">-</div><div class="file-extra">Published</div></div>
      </div>

      <div id="library" style="margin-top:12px">
        <div class="empty" id="placeholder">Enter your GitHub owner and repository above, then click "Load Latest Release". Example owner: <code>yourusername</code>, repo: <code>poultry-website</code>.</div>
        <!-- categories will be injected here -->
      </div>
    </section>

    <section class="card">
      <h2>How to upload files (you)</h2>
      <p class="lead">To add files that appear here (no commits required):</p>
      <ol>
        <li>Go to your GitHub repo → <strong>Releases</strong> → <strong>Draft a new release</strong>.</li>
        <li>Choose a tag (e.g., v1.0) and release title, then attach files to "Attach binaries by dropping them here or selecting them".</li>
        <li>Publish the release. This website will show those assets when you click "Load Latest Release".</li>
      </ol>
      <p style="color:var(--muted);font-size:0.95rem;margin-top:8px">Note: The repository must be <strong>public</strong> for unauthenticated visitors to fetch release info. If your repo is private, you'll need an authenticated proxy or backend.</p>
    </section>

    <section class="card">
      <h2>Notes & Tips</h2>
      <ul>
        <li>This uses the GitHub Releases API (no token) for public repos — rate-limited to 60 requests/hour per IP for unauthenticated calls.</li>
        <li>Files are grouped by extension. Replace owner/repo with your repo to see assets.</li>
        <li>If you want automatic polling (auto-refresh), I can add it — but for now you load manually to save requests.</li>
      </ul>
    </section>
  </main>

  <!-- WhatsApp floating button (your number +2206966648) -->
  <a class="whatsapp-float pulse" href="https://wa.me/2206966648?text=Hello%20I%20want%20to%20download%20files%20from%20your%20poultry%20site" target="_blank" rel="noopener noreferrer" aria-label="Chat on WhatsApp">
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false">
      <path fill="#fff" d="M20.52 3.48A11.95 11.95 0 0 0 12 0C5.373 0 .02 5.373.02 12 0 14.033.548 16.01 1.59 17.71L0 24l6.41-1.66A11.94 11.94 0 0 0 12 24c6.627 0 12-5.373 12-12 0-3.2-1.25-6.16-3.48-8.52z"/>
      <path fill="#25D366" d="M16.32 11.06c-.23-.12-1.36-.67-1.57-.75-.21-.08-.36-.12-.51.12-.15.23-.59.75-.72.9-.13.15-.27.17-.5.06-.23-.12-.97-.36-1.84-1.12-.68-.6-1.14-1.34-1.28-1.57-.13-.23-.01-.35.1-.47.1-.1.23-.27.34-.4.11-.12.15-.2.23-.33.08-.13.03-.25-.02-.37-.05-.12-.51-1.23-.7-1.69-.18-.43-.36-.37-.5-.37-.13-.01-.28-.01-.43-.01-.15 0-.37.05-.56.25-.19.2-.72.7-.72 1.71 0 1 .74 1.97.84 2.11.1.15 1.45 2.34 3.51 3.19 2.06.86 2.06.57 2.43.54.37-.04 1.2-.49 1.37-.97.17-.48.17-.88.12-.97-.05-.08-.18-.12-.41-.23z"/>
    </svg>
  </a>

  <script>
    /* 
      GitHub Releases File Library Script
      - Edit owner and repo from the UI inputs or prefill them for convenience.
      - Works for public repos (no token). 
      - Example usage: owner = "yourusername", repo = "poultry-website"
    */

    // DOM refs
    const loadBtn = document.getElementById('loadBtn');
    const ownerInput = document.getElementById('owner');
    const repoInput = document.getElementById('repo');
    const placeholder = document.getElementById('placeholder');
    const library = document.getElementById('library');
    const metaStats = document.getElementById('metaStats');
    const releaseTagEl = document.getElementById('releaseTag');
    const assetCountEl = document.getElementById('assetCount');
    const releaseDateEl = document.getElementById('releaseDate');
    const searchInput = document.getElementById('search');
    const filterType = document.getElementById('filterType');

    // Category mapping by extension
    const categories = {
      images: ['png','jpg','jpeg','gif','webp','bmp','svg'],
      videos: ['mp4','webm','mov','mkv','avi'],
      documents: ['pdf','doc','docx','xls','xlsx','ppt','pptx','txt','md'],
      archives: ['zip','rar','7z','tar','gz'],
    };

    // utility: determine category from file name
    function getCategory(name) {
      const ext = (name.split('.').pop() || '').toLowerCase();
      if (!ext) return 'others';
      if (categories.images.includes(ext)) return 'images';
      if (categories.videos.includes(ext)) return 'videos';
      if (categories.documents.includes(ext)) return 'documents';
      if (categories.archives.includes(ext)) return 'archives';
      return 'others';
    }

    // format bytes
    function formatBytes(bytes) {
      if (bytes === 0) return '0 B';
      const k = 1024, sizes = ['B','KB','MB','GB','TB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    // fetch latest release and render assets
    async function loadLatestRelease(owner, repo) {
      placeholder.style.display = 'none';
      library.innerHTML = '<div class="empty">Loading latest release…</div>';
      metaStats.style.display = 'none';

      try {
        const apiUrl = `https://api.github.com/repos/${encodeURIComponent(owner)}/${encodeURIComponent(repo)}/releases/latest`;
        const res = await fetch(apiUrl);
        if (res.status === 404) {
          library.innerHTML = `<div class="empty">Repository or release not found. Make sure the repo is public and has at least one release.</div>`;
          return;
        }
        if (!res.ok) {
          library.innerHTML = `<div class="empty">Error fetching release: ${res.status} ${res.statusText}</div>`;
          return;
        }
        const release = await res.json();
        const assets = release.assets || [];

        // show metadata
        releaseTagEl.textContent = release.tag_name || release.name || 'latest';
        assetCountEl.textContent = assets.length;
        releaseDateEl.textContent = new Date(release.published_at).toLocaleString();

        metaStats.style.display = 'flex';

        if (assets.length === 0) {
          library.innerHTML = '<div class="empty">No assets attached to the latest release. Upload files in your repo Releases.</div>';
          return;
        }

        // group assets by category
        const grouped = { images:[], videos:[], documents:[], archives:[], others:[] };
        assets.forEach(a=>{
          const cat = getCategory(a.name);
          grouped[cat].push(a);
        });

        renderGroupedAssets(grouped);
        attachSearchAndFilter(grouped);
      } catch (err) {
        console.error(err);
        library.innerHTML = `<div class="empty">Unexpected error. Check console for details.</div>`;
      }
    }

    function renderGroupedAssets(grouped) {
      library.innerHTML = '';
      const order = ['images','videos','documents','archives','others'];
      const pretty = { images:'Images', videos:'Videos', documents:'Documents', archives:'Archives', others:'Others' };

      order.forEach(cat=>{
        const list = grouped[cat];
        const section = document.createElement('div');
        section.className = 'category';
        const header = document.createElement('h3');
        header.textContent = `${pretty[cat]} (${list.length})`;
        section.appendChild(header);

        if (list.length === 0) {
          const empty = document.createElement('div');
          empty.className = 'empty';
          empty.textContent = `No ${pretty[cat].toLowerCase()} in this release.`;
          section.appendChild(empty);
        } else {
          const ul = document.createElement('ul');
          ul.className = 'file-list';
          list.forEach(asset=>{
            const li = document.createElement('li');
            li.className = 'file-item';
            const meta = document.createElement('div');
            meta.className = 'file-meta';
            const name = document.createElement('div');
            name.innerHTML = `<div class="file-name">${asset.name}</div><div class="file-extra">${formatBytes(asset.size)} • ${asset.content_type || ''}</div>`;
            meta.appendChild(name);

            const actions = document.createElement('div');
            const a = document.createElement('a');
            a.className = 'download-btn';
            a.href = asset.browser_download_url;
            a.target = '_blank';
            a.rel = 'noopener noreferrer';
            a.textContent = 'Download';
            actions.appendChild(a);

            li.appendChild(meta);
            li.appendChild(actions);
            ul.appendChild(li);
          });
          section.appendChild(ul);
        }
        library.appendChild(section);
      });
    }

    // attach search & filter behaviour
    function attachSearchAndFilter(grouped) {
      const allItems = Array.from(document.querySelectorAll('.file-item'));
      function filterAndSearch() {
        const q = (searchInput.value || '').trim().toLowerCase();
        const type = filterType.value; // all / images / videos ...
        allItems.forEach(item=>{
          const name = item.querySelector('.file-name').textContent.toLowerCase();
          const ext = (name.split('.').pop()||'').toLowerCase();
          let show = true;
          if (q) {
            show = name.includes(q) || ext.includes(q);
          }
          if (show && type !== 'all') {
            // check category of this item from ext
            let cat = 'others';
            if (categories.images.includes(ext)) cat='images';
            else if (categories.videos.includes(ext)) cat='videos';
            else if (categories.documents.includes(ext)) cat='documents';
            else if (categories.archives.includes(ext)) cat='archives';
            show = (cat === type);
          }
          item.style.display = show ? 'flex' : 'none';
        });
      }
      searchInput.oninput = filterAndSearch;
      filterType.onchange = filterAndSearch;
    }

    // Load button event
    loadBtn.addEventListener('click', ()=>{
      const owner = ownerInput.value.trim();
      const repo = repoInput.value.trim();
      if (!owner || !repo) {
        alert('Please enter GitHub owner and repository name.');
        return;
      }
      loadLatestRelease(owner, repo);
    });

    // Allow pressing Enter in repo field to load
    repoInput.addEventListener('keydown', (e)=>{
      if (e.key === 'Enter') loadBtn.click();
    });

    // optionally prefill with example (uncomment and set to your repo)
    // ownerInput.value = 'yourusername';
    // repoInput.value = 'poultry-website';

    // Accessibility: allow Ctrl+K to focus search
    document.addEventListener('keydown', (e)=>{
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'k') {
        e.preventDefault();
        searchInput.focus();
      }
    });
  </script>
</body>
</html>